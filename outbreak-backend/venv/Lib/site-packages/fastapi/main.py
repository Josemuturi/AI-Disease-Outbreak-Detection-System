from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
import random

# Initialize the FastAPI app for your Outbreak System
app = FastAPI(
    title="AI-Powered Disease Outbreak Early Warning System",
    description="Backend API for spatial risk analysis and time-series predictions.",
    version="1.0.0"
)

# --- STEP 1: CONFIGURE CORS ---
# This allows your Next.js frontend (Port 3000) to communicate with this Python API
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# --- STEP 2: ROOT ENDPOINT ---
@app.get("/")
def read_root():
    return {
        "status": "System Online",
        "project": "AI Outbreak Early Warning System",
        "developer": "Joseph Muturi",
        "framework": "FastAPI"
    }

# --- STEP 3: SPATIAL RISK DATA (For Kenya Map) ---
@app.get("/api/v1/county-risks")
async def get_county_risks():
    """
    Simulates disease risk probability per county.
    Target for Objective 1: Data Integration.
    """
    counties = [
        "Nairobi", "Mombasa", "Kiambu", "Nakuru", "Uasin Gishu", 
        "Kisumu", "Wajir", "Mandera", "Kilifi", "Kajiado",
        "Machakos", "Garissa", "Narok", "Bomet", "Kakamega"
    ]
    # In the next step, we will replace this with your LSTM/ARIMA outputs
    return {county: random.randint(10, 95) for county in counties}

# --- STEP 4: PREDICTIVE TRENDS (For Outbreak Chart) ---
@app.get("/api/v1/trends")
async def get_trends():
    """
    Returns time-series data for comparing Actual vs Predicted cases.
    Aligns with your Chapter 3 research methodology.
    """
    return [
        {"month": "Jan", "actual": 120, "predicted": 118},
        {"month": "Feb", "actual": 145, "predicted": 140},
        {"month": "Mar", "actual": 190, "predicted": 185},
        {"month": "Apr", "actual": 160, "predicted": 210}, # Predictive surge
        {"month": "May", "predicted": 240}, # Pure AI forecast
    ]